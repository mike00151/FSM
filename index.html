<html>

<head>
    <title>FSM</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tone/13.8.25/Tone.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/app.js"></script>
</head>

<body>
    <table>
        <tbody id="play-list">
            <tr>
                <th>頻率</th>
                <th>波型</th>
                <th>時間(秒)</th>
                <th>
                    <button title="add" onclick="addFrequencySet()">新增</button>
                    <button title="play" onclick="play()">執行</button>
                </th>
            </tr>
        </tbody>
    </table>

    <script type="text/javascript">
        function addFrequencySet(){
            var table = document.getElementById("play-list");
            var row = table.insertRow(-1);
            var frequency = row.insertCell(0);
            var waveType = row.insertCell(1);
            var timeInSeconds = row.insertCell(2);
            var deletion = row.insertCell(3);
            frequency.innerHTML = '頻率1 : <input type="text" name="frequency1"/><br>頻率2 : <input type="text" name="frequency2"/>';
            waveType.innerHTML = '波型 <select name="wave"><option value="0">波型</option><option value="sine">sine</option><option value="square">square</option></select>';
            timeInSeconds.innerHTML = '持續時間: <input type="text" name="timeInSeconds"/>';
            deletion.innerHTML = '<button class=button title="delete" onclick="deleteFrequencySet(this)">刪除</button>';
        }

        function deleteFrequencySet(button){
            var table = document.getElementById("play-list");
            table.deleteRow(button.parentNode.parentNode.rowIndex);
        }

        function play(){
            document.querySelectorAll("#play-list tr").forEach((d, i, array)=>{

                if (i == 0){
                    return;
                } 

                var content = {
                    'frequency1' : d.querySelector('*[name="frequency1"]').value,
                    'frequency2' : d.querySelector('*[name="frequency2"]').value,
                    'wave' : d.querySelector('*[name="wave"]').value,
                    'timeInSeconds' : "+"+d.querySelector('*[name="timeInSeconds"]').value
                }

                console.log(content);
                playPerSet(content);
                })
        }
    </script>
</body>

</html>